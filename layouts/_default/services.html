{{- define "main" -}}
{{- $maxwidth := "maxw80r" -}}
{{- if (eq ($.Param "widelayout") true) -}}
  {{- $maxwidth = "" -}}
{{- end -}}

<div class="dev-docs__menu" data-drawer data-drawer-event>
  {{- partial "sidemenu.html" . -}}
</div>
{{- partial "drawmenu.html" . -}}
<div class="dev-docs__page">
  <main id="main" class="dev-docscontent w100p {{ $maxwidth }}">
    <article>
      <h1>
        {{- .Title -}}
        {{- with .Params.titlesub -}}
          <span class="db text-title mts">{{ . }}</span>
        {{- end -}}
      </h1>
      {{- range .Params.tables -}}
        <section class="dev-docscontent__section">
          <h2 class="dev-anchored mrl" id="{{ .title|anchorize }}" >{{ .title }}</h2>
          {{- if in .title "Booking" -}}
            {{- partial "services/booking-sg" (dict "data" (index $.Site.Data .data)) -}}
          {{- end -}}
          {{- if in .title "Value" -}}
            {{- partial "services/vas" (dict "data" (index $.Site.Data .data) "examples" $.Site.Data.examples) -}}
          {{- end -}}

        {{ if in .title "Reports" }}
          {{- partial "services/spreadsheetinfo" -}}
          <div class="flex flex-wrap align-ifs mbs bg-gray1 pal pr0 rad-a2px">
            <div class="mrl">
              <div class="flex flex-wrap-reverse align-ifs">
                <div class="mrl">
                  <p class="form__label">Filter by</p>
                  <div class="btngroup">
                    {{- partial "services/filterbtn" (dict "dataAtt" "data-ri-filterset='rifamily'" "btnText" "Service family") -}}
                    {{- partial "services/filterbtn" (dict "dataAtt" "data-ri-filterset='riapi'" "btnText" "API") -}}
                    {{- partial "services/filterbtn" (dict "dataAtt" "data-ri-filterset='rireptype'" "btnText" "Report type") -}}
                  </div>
                </div>
                <label class="form__label" for="ri-textfilter">
                  Reports name
                  <input id="ri-textfilter" type="text" class="form__control mrxs w100p maxw32r"/>
                </label>
              </div>
              <div id="ri-filtersets">
                {{- $.Scratch.Add "rifamily" slice -}}
                {{- $.Scratch.Add "riapi" slice -}}
                {{- $.Scratch.Add "rireptype" slice -}}
                {{- range index $.Site.Data .data -}}
                  {{- $.Scratch.Add "rifamily" .ServiceFamily }}
                  {{- $.Scratch.Add "rireptype" .ReportType }}
                {{- end -}}
                {{- $.Scratch.Add "riapi" "Invoice" }}
                {{- $.Scratch.Add "riapi" "Reports" }}
                {{- partial "services/servicefilter" (dict "filterScratch" ($.Scratch.Get "rifamily") "filter" "rifamily" ) -}}
                {{- partial "services/servicefilter" (dict "filterScratch" ($.Scratch.Get "riapi") "filter" "riapi" ) -}}
                {{- partial "services/servicefilter" (dict "filterScratch" ($.Scratch.Get "rireptype") "filter" "rireptype" ) -}}
              </div>
            </div>
            <div class="maxw100p">
              <div id="ri-filtercombo" class="mtm mrm text-note"></div>
              <button type="button" id="ri-clearfilters" class="btn-link--dark mtl mrl dn">Clear all filters</button>
            </div>
          </div>
          <table id="services-ri">
            <thead>
              <tr>
                <th>Service family</th>
                <th>Customer number type</th>
                <th>API</th>
                <th>Report type</th>
                <th>Reports name</th>
              </tr>
            </thead>
            <tbody>
              {{- $looper := 0 -}}
              {{- $apiLooper := 1 -}}
              {{- $fam := "" -}}
              {{- $thisApi := "" -}}
              {{- $prevApi := "" }}

              {{- range index $.Site.Data .data -}}
                {{- $prevApi = $thisApi -}}

                {{- if ne $fam .ServiceFamily -}}
                  {{- $looper = 0 -}}
                  {{- $apiLooper = 1 -}}
                  {{- $prevApi = "" -}}
                {{- end -}}
                {{- $looper = add $looper 1 -}}
                {{- $.Scratch.SetInMap "famLooper" .ServiceFamily $looper -}}
                {{- $fam = .ServiceFamily -}}

                {{- if eq .Reports "Yes" -}}
                  {{- $thisApi = "Reports" -}}
                {{- else -}}
                  {{- $thisApi = "Invoice" -}}
                {{- end -}}
                {{- if eq $thisApi $prevApi -}}
                  {{- $apiLooper = add $apiLooper 1 -}}
                {{- end -}}
                {{- $.Scratch.SetInMap "repLooper" .ServiceFamily $apiLooper -}}
              {{- end -}}

              {{- range index $.Site.Data .data -}}
                {{- if eq .Reports "Yes" -}}
                  {{- $thisApi = "Reports" -}}
                {{- else -}}
                  {{- $thisApi = "Invoice" -}}
                {{- end -}}
                <tr
                  data-rifamily="{{.ServiceFamily}}"
                  data-cntype="{{ .CustomerNumberType }}"
                  data-riapi="{{ $thisApi }}"
                  data-rireptype="{{ .ReportType }}"
                  data-rirepname="{{ .ReportsName }}"
                >
                  {{- if ne $fam .ServiceFamily -}}
                    <th scope="row" rowspan='{{ index ($.Scratch.Get "famLooper") .ServiceFamily }}' class="originalel maxw20r">
                        {{- .ServiceFamily -}}
                    </th>
                    <td rowspan='{{ index ($.Scratch.Get "famLooper") .ServiceFamily }}' class="originalel">
                      {{- .CustomerNumberType -}}
                    </td>
                  {{- end -}}
                  {{- if eq .Invoice "Yes" -}}
                    <td class="originalel"><span class="mb-badge">{{ $thisApi }}</span></td>
                    {{- $prevApi = $thisApi -}}
                  {{- end -}}
                  {{- if eq .Reports "Yes" -}}
                    {{- if ne $thisApi $prevApi -}}
                      <td rowspan='{{ index ($.Scratch.Get "repLooper") .ServiceFamily }}' class="originalel"><span class="mb-badge">{{ $thisApi }}</span></td>
                      {{- $prevApi = $thisApi -}}
                    {{- end -}}
                  {{- end -}}
                  <td>{{ if .ReportType }}{{ .ReportType }}{{else}}-{{ end }}</td>
                  <td data-filter="rep-name">{{ if .ReportsName }}{{ .ReportsName }}{{else}}-{{ end }}</td>
                </tr>
                {{- $fam = .ServiceFamily -}}
              {{- end -}}
            </tbody>
          </table>
          <div class="cutoff-overlay" id="ri-cutoff">
            <button type="button" class="btn btn--white w100p maxw32r">Show all service families</button>
          </div>
          {{- end -}}
        </section>
        {{- end -}}
      </article>
    </main>
    <script async src='{{ "/js/servicefiltering.js" | relURL }}'></script>
  {{ partial "footer.html" . }}
  <div class="dev-obfuscator" data-drawer data-drawer-event></div>
</div>
{{- end -}}
