{{- $request := .requestBody -}}
{{- $components := .components -}}
{{- $endpointId := .endpointId -}}

<h3>Request examples</h3>
<div class="bg-gray3 rad-t2px mts" id="{{ $endpointId }}-request">
  {{- with $request.content -}}
    {{- $multiTypes := false -}}
    {{- if gt (len .) 1 -}}
      {{- $multiTypes = true -}}
    {{- end }}
    {{- $requestId := print $endpointId "-req" -}}

    <div class="relative bg-gray4 example-wrap" data-example="{{ $endpointId }}">

      {{/*  Make select if types > 1  */}}
      {{- if $multiTypes -}}
        <div class="mhm pvm">
          <select data-sub-of="{{ $requestId }}" class="form__control w100p mb0 pas hauto" name="formats" aria-label="Select request format">
            {{- range $mediaType, $_ := . -}}
              {{- $typeClean := lower (anchorize $mediaType) -}}
              <option value="{{ $typeClean }}">{{ $mediaType }}</option>
            {{- end -}}
          </select>
        </div>
      {{- end -}}

      {{/*  Make examples according to number of types  */}}
      {{- $exFormatInd := 0 -}}
      {{- range $mediaType, $_ := . -}}
        {{ $mediaType = lower (anchorize $mediaType) }}
        {{- $format := "json" -}}
        {{- if in $mediaType "xml" -}}
          {{- $format = printf "xml" -}}
        {{- end -}}
        {{- $schema := .schema -}}

        {{- if isset . "examples" -}}
          <div class="" data-type="{{ $mediaType }}" {{ if ne $exFormatInd 0 }}hidden{{ end }}>
            {{/*  make select if the request has multiple examples  */}}
            {{- if gt (len .examples) 1 -}}
              <div class="mhm {{ if not $multiTypes }}ptm{{ end }}">
                <select class="form__control w100p mb0 pas hauto" name="{{ $mediaType }}-{{ $requestId }}" data-example-sub aria-label="Request examples {{ $format }}">
                  {{- range $name, $obj := .examples -}}
                    {{- with $obj.description -}}
                      {{- $name = . -}}
                    {{- end -}}
                    {{- range $k, $_ := $obj -}}
                      {{- if eq $k "$ref" -}}
                        {{- $examplePath := path.Split . -}}
                        {{- $exampleId := lower (printf "%s-%s" $requestId $examplePath.File) -}}
                        <option value="{{ $exampleId }}">{{ $name }}</option>
                      {{- end -}}
                    {{- end -}}
                  {{- end -}}
                </select>
              </div>
            {{- end -}}

            {{- $exInd := 0 -}}

            {{/*  Make the actual examples with named components  */}}
            {{- range .examples -}}
              {{- range $k, $_ := . -}}
                {{- if eq $k "$ref" -}}
                  {{- $examplePath := path.Split . -}}
                  {{- $exampleId := lower (printf "%s-%s" $requestId $examplePath.File) -}}
                  {{- range $k, $_ := index $components.examples $examplePath.File -}}
                    {{- if eq $k "description" -}}
                      <p class="mlm">{{ . }}</p>
                    {{- else -}}
                      <div class="relative mtm" data-example-sub="{{$exampleId}}" {{ if ne $exInd 0 }}hidden{{ end }}>
                        {{- if eq $format "xml" -}}
                          {{- partial "api/oas/example-xml.html" (dict "schemaObj" $schema "name" "" "components" $components "exampleObj" . ) -}}
                        {{- else -}}
                          {{- partial "api/oas/example-json.html" (dict "key" $examplePath.File "ctx" . "schemas" $components.schemas) . -}}
                        {{- end -}}
                        {{- partial "api/oas/copy-btn.html" -}}
                      </div>
                    {{- end -}}
                  {{- end -}}
                  {{- $exInd = add $exInd 1 -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
          </div>
        {{- end -}}
      {{- end -}}
    </div>
  {{- end -}}
</div>
