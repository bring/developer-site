{{- $response := .response -}}
{{- $components := .components -}}
{{- $endpointId := .endpointId -}}

<h3>Response examples</h3>
{{- $codeExample := "" -}}
{{- $resInd := 0 -}}
<div class="bg-gray3 rad-t2px mts sticky-6r" id="{{$endpointId}}-response">
  {{- partial "api/oas/responsecode-btns.html" (dict "responses" .responses "endpointId" $endpointId) -}}
  {{- range $response, $_ := .responses -}}
    {{- with .content -}}
      {{- $responseId := print $endpointId "-" $response -}}
      <div class="relative" data-example="{{$responseId}}" role="tabpanel" aria-labelledby="{{$responseId}}" {{if ne $resInd 0}}hidden{{end}}>
      {{- range $application, $_ := . -}}
        {{- if in $application "json" -}}
          {{/* If application type contains examples object */}}
          {{- if isset . "examples" -}}
            {{- range index $components.examples $response -}}
              {{- $codeExample = . | jsonify (dict "indent" "  ") -}}
              {{- highlight $codeExample "json" -}}
              {{- partial "api/oas/copy-btn.html" -}}
            {{- else -}}
              {{/* if there is only one object */}}
              {{- if gt (len .examples) 1 -}}
              <div class="phm pvm bg-gray4">
                <select class="form__control w100p mb0" name="{{$responseId}}" data-example-sub aria-label="Response code {{$response}} example">
                  {{- range $name, $val := .examples -}}
                    {{- with $val.description -}}
                      {{- $name = . -}}
                    {{- end -}}
                    {{- range $k, $_ := . -}}
                      {{- if eq $k "$ref" -}}
                        {{- $exPath := path.Split . -}}
                        {{- $exId := print $responseId "-" $exPath.File -}}
                        <option value="{{ $exId }}">{{ $name }}</option>
                      {{- end -}}
                    {{- end -}}
                  {{- end -}}
                </select>
              </div>
              {{- end -}}
              
              {{- $exInd := 0 -}}

              {{- range .examples -}}
                {{- range $k, $_ := . -}}
                  {{- if eq $k "$ref" -}}
                    {{- $exPath := path.Split . -}}
                    {{- $exId := print $responseId "-" $exPath.File -}}
                    <div class="relative" data-example-sub="{{$exId}}" {{if ne $exInd 0}}hidden{{end}}>
                      {{- range index $components.examples $exPath.File -}}
                        {{- $codeExample = . | jsonify (dict "indent" "  ") -}}
                        {{- $codeExample = replace $codeExample "\\u0026" "&" -}}
                        {{- highlight $codeExample "json" -}}
                      {{- end -}}
                      {{- partial "api/oas/copy-btn.html" -}}
                    </div>
                    <div class="relative" data-example-sub="{{$exId}}" {{if ne $exInd 0}}hidden{{end}}>
                      {{- range index $components.examples $exPath.File -}}
                        {{- $xmlExample := println "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>" -}}
                        {{- $xmlExamplePart := partial "api/oas/responsexml.html" (dict "ctx" .) -}}
                        {{- $xmlExample = printf "%s%s" $xmlExample $xmlExamplePart -}}
                        {{- highlight $xmlExample "xml" -}}
                      {{- end -}}
                    </div>
                    {{- $exInd = add $exInd 1 -}}
                  {{- end -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
      </div>
      {{- $resInd = add $resInd 1 -}}
    {{- end -}}
  {{- end -}}
</div>
