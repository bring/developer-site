{{- $response := .response -}}
{{- $components := .components -}}
{{- $endpointId := .endpointId -}}

<h3>Response examples</h3>
{{- $resInd := 0 -}}
<div class="bg-gray3 rad-t2px mts sticky-6r" id="{{$endpointId}}-response">
  {{- partial "api/oas/responsecode-btns.html" (dict "responses" .responses "endpointId" $endpointId) -}}
  {{- range $response, $_ := .responses -}}
    {{- with .content -}}
      {{- $multiTypes := false -}}
      {{- if gt (len .) 1 -}}
        {{- $multiTypes = true -}}
      {{- end }}

      {{- $responseId := print $endpointId "-" $response -}}
      <div class="relative bg-gray4 example-wrap" data-example="{{ $responseId }}" role="tabpanel" aria-labelledby="{{ $responseId }}" {{ if ne $resInd 0 }}hidden{{ end }}>

        {{/*  Make select if types > 1  */}}
        {{- if $multiTypes -}}
          <div class="mhm pvm">
            <select data-sub-of="{{ $responseId }}" class="form__control w100p mb0 pas hauto" name="formats" aria-label="Select format">
              {{- range $mediaType, $_ := . -}}
                {{- $typeClean := lower (anchorize $mediaType) -}}
                <option value="{{ $typeClean }}">{{ $mediaType }}</option>
              {{- end -}}
            </select>
          </div>
        {{- end -}}

        {{/*  Make examples according to number of types  */}}
        {{ $exFormatInd := 0 }}
        {{- range $mediaType, $_ := . -}}
          {{ $mediaType = lower (anchorize $mediaType) }}
          {{- $format := "json" -}}
          {{- if in $mediaType "xml" -}}
            {{- $format = printf "xml" -}}
          {{- end -}}

          {{- $schema := .schema -}}
          {{- if isset . "examples" -}}
            <div class="" data-type="{{ $mediaType }}" {{ if ne $exFormatInd 0 }}hidden{{ end }}>
              {{/*  Make singular examples that are referenced using the response code in the components  */}}
              {{- range index $components.examples $response -}}
                <div class="relative mtm">
                  {{- if eq $format "xml" -}}
                    {{- partial "api/oas/example-xml.html" (dict "schemaObj" $schema "name" "" "components" $components "exampleObj" . ) -}}
                  {{- else -}}
                    {{- partial "api/oas/example-json.html" (dict "ctx" . "schemas" $components.schemas) -}}
                  {{- end -}}
                </div>
              {{- else -}}
                {{/*  if the code doesnâ€™t exist in $components.examples, look for examples in the response object  */}}

                {{/*  make select if the response has multiple examples  */}}
                {{- if gt (len .examples) 1 -}}
                  <div class="mhm {{ if not $multiTypes }}ptm{{ end }}">
                    <select class="form__control w100p mb0 pas hauto" name="{{ $mediaType }}-{{ $responseId }}" data-example-sub aria-label="Response code {{ $response }} {{ $format }} example">
                      {{- range $name, $obj := .examples -}}
                        {{- with $obj.description -}}
                          {{- $name = . -}}
                        {{- end -}}
                        {{- range $k, $_ := $obj -}}
                          {{- if eq $k "$ref" -}}
                            {{- $examplePath := path.Split . -}}
                            {{- $exampleId := lower (printf "%s-%s" $responseId $examplePath.File) -}}
                            <option value="{{ $exampleId }}">{{ $name }}</option>
                          {{- end -}}
                        {{- end -}}
                      {{- end -}}
                    </select>
                  </div>
                {{- end -}}

                {{- $exInd := 0 -}}

                {{/*  Make the actual examples with named components (in contrast to those only using the response code)  */}}
                {{- range .examples -}}
                  {{- range $k, $_ := . -}}
                    {{- if eq $k "$ref" -}}
                      {{- $examplePath := path.Split . -}}
                      {{- $exampleId := lower (printf "%s-%s" $responseId $examplePath.File) -}}
                      {{- range index $components.examples $examplePath.File -}}
                        <div class="relative mtm" data-example-sub="{{$exampleId}}" {{ if ne $exInd 0 }}hidden{{ end }}>
                          {{- if eq $format "xml" -}}
                            {{- partial "api/oas/example-xml.html" (dict "schemaObj" $schema "name" "" "components" $components "exampleObj" . ) -}}
                          {{- else -}}
                            {{- partial "api/oas/example-json.html" (dict "key" $examplePath.File "ctx" . "schemas" $components.schemas) . -}}
                          {{- end -}}
                          {{- partial "api/oas/copy-btn.html" -}}
                        </div>
                      {{- end -}}
                      {{- $exInd = add $exInd 1 -}}
                    {{- end -}}
                  {{- end -}}
                {{- end -}}

              {{- end -}}
            </div>
          {{- end -}}

          {{ $exFormatInd = add $exFormatInd 1 }}
        {{- end -}}
      </div>
      {{- $resInd = add $resInd 1 -}}
    {{- end -}}
  {{- end -}}
</div>
