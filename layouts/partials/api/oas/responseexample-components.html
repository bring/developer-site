{{- $response := .response -}}
{{- $components := .components -}}
{{- $endpointId := .endpointId -}}

<h3>Response examples</h3>
{{- $resInd := 0 -}}
<div class="bg-gray3 rad-t2px mts sticky-6r" id="{{$endpointId}}-response">
  {{- partial "api/oas/responsecode-btns.html" (dict "responses" .responses "endpointId" $endpointId) -}}
  {{- range $response, $_ := .responses -}}
    {{- with .content -}}
      {{- $responseId := print $endpointId "-" $response -}}
      <div class="relative bg-gray4 example-wrap" data-example="{{$responseId}}" role="tabpanel" aria-labelledby="{{$responseId}}" {{if ne $resInd 0}}hidden{{end}}>

        {{ $showFormatMenu := 0 }}
        {{ range $application, $_ := . }}
          {{ if or (in $application "json") (in $application "xml") }}
            {{ $showFormatMenu = add $showFormatMenu 1 }}
          {{ end }}
        {{ end }}
        {{ if gt $showFormatMenu 1 }}
          <div class="mhm ptm">
            <select class="form__control w100p mb0 pas schema-type-select" name="formats" data-example-sub aria-label="Select format">
              {{ range $application, $_ := . }}
                <option value="{{$application}}">{{$application}}</option>
              {{ end }}
            </select>
          </div>
        {{ end }}

        {{- range $application, $_ := . -}}
          {{- $format := "" -}}
          {{- if in $application "json" -}}
            {{- $format = "json" -}}
          {{- else if in $application "xml" -}}
            {{- $format = printf "xml" -}}
          {{- end -}}

          {{- if or (in $application "json") (in $application "xml") -}}
            {{- if isset . "examples" -}}
              {{/* Loop over the examples using the response refs as index */}}
              {{- range index $components.examples $response -}}
                {{- partial (printf "api/oas/example-%s.html" $format) . -}}
              {{- else -}}
                {{/* make select if more than one example */}}
                {{- if gt (len .examples) 1 -}}
                  <div class="mhm ptm">
                    <select class="form__control w100p mb0 pas schema-type-select" name="{{$format}}-{{$responseId}}" data-example-sub aria-label="Response code {{$response}} {{$format}} example">
                      {{- range $name, $val := .examples -}}
                        {{- with $val.description -}}
                          {{- $name = . -}}
                        {{- end -}}
                        {{- range $k, $_ := . -}}
                          {{- if eq $k "$ref" -}}
                            {{- $exPath := path.Split . -}}
                            {{- $exId := print $responseId "-" $exPath.File -}}
                            <option value="{{ $exId }}">{{ $name }}</option>
                          {{- end -}}
                        {{- end -}}
                      {{- end -}}
                    </select>
                  </div>
                {{- end -}}

                {{- $exInd := 0 -}}

                {{- range .examples -}}
                  {{- range $k, $_ := . -}}
                    {{- if eq $k "$ref" -}}
                      {{- $exPath := path.Split . -}}
                      {{- $exId := print $responseId "-" $exPath.File -}}

                      <div class="relative mtm" data-example-sub="{{$exId}}" data-format="{{$application}}" {{if ne $exInd 0}}hidden{{end}}>
                        {{- range index $components.examples $exPath.File -}}
                          {{- partial (printf "api/oas/example-%s.html" $format) . -}}
                        {{- end -}}
                      </div>

                      {{- $exInd = add $exInd 1 -}}
                    {{- end -}}
                  {{- end -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
        {{- end -}}
      </div>
      {{- $resInd = add $resInd 1 -}}
    {{- end -}}
  {{- end -}}
</div>
