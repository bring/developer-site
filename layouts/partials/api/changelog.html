<section class="dev-docscontent__section">
  <div class="gaxl flex flex-wrap flex-dir-row-rev justify-cfe">
    <div class="updates__sub bg-green1 pal align-sfs">
      <h2>Subscribe</h2>
      <p class="mbm">Get updates via email or subscribe to our <a href='{{ "api/revision-history/index.xml" | relURL }}'>RSS feed</a>.</p>
      {{- partial "subscribe.html" -}}
    </div>

    <div class="updates__log">
      {{- $pageSubTitle := "Important API changes" -}}
      {{- if .Params.apiArea -}}
        {{- $pageSubTitle = (printf "%s %s" .Params.apiArea "APIs") -}}
      {{- end -}}
      {{- $pctx := . -}}
      {{- if (in .CurrentSection "revision-history/_") -}}
        {{- $pctx = .Site -}}
      {{- end -}}
      <h2 class="mbl">{{$pageSubTitle}}</h2>
      {{- $mergedPages := slice -}}
      {{/* Get entries from the main folder when in context of a sub-section */}}
      {{- if (eq $pctx .) -}}
        {{- $generalPage := .Site.GetPage "revision-history" -}}
        {{- $generalPages := $generalPage.RegularPages -}}
        {{- range $generalPages -}}
          {{- $mergedPages = $mergedPages | append (dict "pagePath" . "pubDate" .Params.publishdate) -}}
        {{- end -}}
      {{- end -}}
      {{- $pages := slice -}}
      {{- $pages = $pctx.RegularPages -}}
      {{/* Get all sections from revision-history */}}
      {{- range $pages -}}
        {{- if (in .CurrentSection "revision-history") -}}
          {{- $mergedPages = $mergedPages | append (dict "pagePath" . "pubDate" .Params.publishdate) -}}
        {{- end -}}
      {{- end -}}
      {{/* Make a new array and rearrange the data based on publish date */}}
      {{- $rearrangedPages := slice -}}
      {{- range sort $mergedPages "pubDate" "desc" -}}
        {{- $rearrangedPages = $rearrangedPages | append .pagePath -}}
      {{- end -}}
      {{/* Set $pages to the rearranged structure */}}
      {{- $pages = $rearrangedPages -}}
      {{- range first 5 $pages -}}
        <article class="mbl">
          <header class="flex flex-dir-col-rev">
            <h2 class="text-heading fw600 mb0">{{ .Title }}</h2>
            <time
              class="mrm text-note fw600"
              datetime="{{ .PublishDate.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}"
              >{{ .PublishDate.Format "2. January 2006" | safeHTML }}</time
            >
          </header>
          {{ .Content }}
        </article>
      {{- end -}}
    </div>
  </div>
  {{- if (gt (len $pages) 5) -}}
  <details class="mb-disclosure">
    <summary class="pam maxw32r bg-gray1">Older updates</summary>
    <div class="flex flex-wrap">
      {{- range after 5 $pages -}}
        <article class="changelog-small bg-gray1 pal mbxs">
          <header class="flex flex-dir-col-rev">
            <h2 class="text-basic fw600 mb0">{{ .Title }}</h2>
            <time
              class="mrm text-note fw600"
              datetime="{{ .PublishDate.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}"
              >{{ .PublishDate.Format "2. January 2006" | safeHTML }}</time
            >
          </header>
          {{ .Content }}
        </article>
      {{- end -}}
    </div>
  </details>
  {{- end -}}
</section>
